MYD-J335X
=========

History:
=======
V1.0
    Description : Create ininital version.
    Author      : Sunny Guo[sunny.guo@myirtech.com]
    Date        : 2017/08/23
V1.1 
    Description : Add support for emmc core board.
		  Add updatesys from sd to emmc, from sd to nand.
		  Move sdio wifi firmware from kernel to rootfs-overlay
    Author      : Sunny Guo[sunny.guo@myirtech.com]
    Date        : 2017/09/29

Introduction
==============
To be able to use MYD-J335X board of MYIR with the images generated by
Buildroot, you have to prepare a SDCard and a USB stick.

How to build it
===============

For NAND: 
  $ make myd_j335x_defconfig
For EMMC:
  $ make myd_j335x_emmc_defconfig

Then you can edit the build options using

  $ make menuconfig

Compile all and build rootfs image:

  $ make

Result of the build
-------------------

After building, you should get a tree like this:

  output/images/
  ├── MLO
  ├── MLO_emmc
  ├── MLO_nand
  ├── MLO_sd
  ├── MLO_usbmsc
  ├── u-boot.img
  ├── u-boot_nand.img
  ├── u-boot_emmc.img
  ├── u-boot_sd.img
  ├── u-boot_usbmsc.img
  ├── u-boot-spl.bin
  ├── uEnv.txt			# default uEnv.txt
  ├── uEnv_mmc.txt		# uEnv.txt for emmc
  ├── uEnv_sd.txt		# uEnv.txt for sd with ext4 rootfs
  ├── uEnv_sd_ramdisk.txt	# uEnv.txt for sd with ramdisk rootfs
  ├── uEnv_usbmsc.txt		# uEnv.txt for usb mass storage device with ext4 rootfs
  ├── uEnv_usbmsc_ramdisk.txt	# uEnv.txt for usb mass storage device with ramdisk rootfs
  ├── uEnv_ramdisk.txt
  ├── myd_j335x.dtb           # device tree for nand core board
  ├── myd_j335x_emmc.dtb	# device tree for emmc core boad
  ├── zImage
  ├── rootfs.cpio
  ├── rootfs.cpio.gz
  ├── rootfs.cpio.uboot
  ├── rootfs.ext2
  ├── rootfs.ext4
  ├── rootfs.tar
  ├── rootfs.tar.gz
  ├── rootfs.ubi        # rootfs image for NAND Flash 
  ├── rootfs.ubifs
  ├── sdcard.img		# disk image for sd card with ext4 rootfs
  └── zImage

How to use it
===============
1. Boot from TF/SD card with ramdisk
  - Format TF/SD with fat/fat32 format
  - Copy MLO, u-boot.img, uEnv_ramdisk.txt, zImage, myd_j335x.dtb, ramdisk.gz to TF/SD card.
  - Rename uEnv_ramdisk.txt to uEnv.txt
  - Insert the TF/SD card to slot, and set bootmode to mmc0
  - Powreoff and poweron to boot from TF/SD card with ramdisk
   
2. Boot from TF/SD card with EXT4 partition on TF/SD card
  - Program sdcard.img to TF/SD card with Win32DiskImager.exe on windows pc.
  - Powreoff and poweron to boot from TF/SD card with ext4 partition on TF/SD card.

3. Boot from Ethernet with NFS
  - Enter U-boot console by press 'space' when u-boot booting from TF/SD card.
  - setenv serverip 192.168.1.2 ( nfs server and tftp server hosted on 192.168.1.2)
  - setenv ipaddr 192.168.1.100 ( set the ipaddr of myd_j335x board)
  - setenv rootpath /home/sunny/export/rootfs ( exported nfs directory with /etc/exports file on nfs server)
  - run netboot

4. Boot from Ethernet with ramdisk
  - Enter U-boot console by press 'space' when u-boot booting from TF/SD card.
  - setenv serverip 192.168.1.2 ( nfs server and tftp server hosted on 192.168.1.2)
  - setenv ipaddr 192.168.1.100 ( set the ipaddr of myd_j335x board)
  - setenv bootargs console=ttyO0,115200n8 root=/dev/ram0 rw rootfstype=ext2 ip=none earlyprintk
  - tftpboot ${loadaddr} zImage  ( zImage was copied to tftp server root directory)
  - tftpboot ${rdaddr} ramdisk.gz ( ramdisk.gz was copied to tftp server root directory)
  - tftpboot ${fdtaddr} myd_j335x.dtb  ( myd_j335x.dtb was copied to tftp server root directory)
  - bootz  ${loadaddr} ${rdaddr} ${fdtaddr}

5. Boot from Nand
  - Copy MLO, u-boot.img, uEnv_ramdisk.txt, zImage, myd_j335x.dtb, ramdisk.gz, rootfs.ubi to TF/SD card.
  - Rename uEnv_ramdisk.txt to uEnv.txt
  - Insert the TF/SD card to slot, and set bootmode to mmc0
  - PowerOff and PowerOn to boot from TF/SD card, press 'space' to interrupt u-boot and enter the u-boot console
  - Execute 'run updatesys' in u-boot console to write MLO, u-boot.img, zImage, myd_j335x.dtb, rootfs.ubi to nand
  - User can also update image from linux with the script "/etc/modules-load.myir/updatesys.sh loader2nand sd"
  - Set bootmode to nand and poweron

6. Boot from EMMC
  - Format TF/SD with fat/fat32 format
  - Copy all image files compiling with "myd_j335x_emmc_defconfig" to the TF/SD card.
  - Set "fdtfile=myd_j335x_emmc.dtb" in uEnv_ramdisk.txt and rename uEnv_ramdisk.txt to uEnv.txt.
  - Boot from TF/SD and login into linux 
  - Run "/etc/modules-load.myir/updatesys.sh loader2emmc sd" to write the image files from TF/SD to emmc
  - Change the boot mode to emmc and repower up.

Auto Update System
==================
Users can update system from sd to nand or emmc automatically by setting different optargs in uEnv.txt

1. Auto update from sd to nand
  - Add "optargs = updatesys_from_sd_to_nand" to the uEnv.txt in TF/SD
  - Boot from TF/SD

2. Auto update from sd to emmc
  - Add "optargs = updatesys_from_sd_to_emmc" to the uEnv.txt in TF/SD
  - Boot from TF/SD

Links
===============
1. https://sourceforge.net/projects/win32diskimager/
2. https://buildroot.org/
